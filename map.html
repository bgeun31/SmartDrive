<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>서울 꽃나들이 장소</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=3n3v7ntkle"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
        }
        #map {
            width: 100%;
            height: 100vh;
            transition: width 0.3s;
        }
        #sidebar {
            width: 400px; /* 너비를 충분하게 조정 */
            height: 100vh;
            background-color: #f4f4f4;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            position: absolute;
            left: -250px; /* 초기에 사이드바 숨기기 */
            transition: left 0.3s;
            left: 0;
        }
        
        #sidebar.open {
            left: 0;
        }
        #toggle-button {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
        .sidebar-header {
            padding: 15px;
            background: #333;
            color: #fff;
            text-align: center;
        }
        .sidebar-content {
            padding: 15px;
        }
        .course-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #007bff;
            color: #fff;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
        }
        .course-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <button id="toggle-button" onclick="toggleSidebar()">코스 선택</button>
    <div id="sidebar">
        <div class="sidebar-header">
            <h2>코스 선택</h2>
        </div>
        <div class="sidebar-content">
            <div class="course-button" onclick="selectCourse('A코스')">A코스: 서울숲 - 올림픽공원</div>
            <div class="course-button" onclick="selectCourse('B코스')">B코스: 남산공원 - 서울숲</div>
        </div>
    </div>
    <div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        var mapOptions = {
            center: new naver.maps.LatLng(37.5665, 126.9780),
            zoom: 12
        };
        var map = new naver.maps.Map('map', mapOptions);

        var places = {
            "서울숲": {latlng: new naver.maps.LatLng(37.544579, 127.037649), img: "image/서울숲.jpeg", desc: "서울숲은 다양한 꽃과 나무가 있는 아름다운 공원입니다."},
            "남산공원": {latlng: new naver.maps.LatLng(37.5511694, 126.9882266), img: "image/남산공원.jpeg", desc: "남산공원은 서울을 한눈에 볼 수 있는 멋진 장소입니다."},
            "올림픽공원": {latlng: new naver.maps.LatLng(37.516436, 127.115046), img: "image/올림픽공원.jpeg", desc: "올림픽공원은 다양한 꽃과 예술작품이 있는 넓은공원입니다."},
            "경복궁": {latlng: new naver.maps.LatLng(37.579617, 126.977041), img: "image/경복궁.jpeg", desc: "경복궁은 역사적인 장소로, 아름다운 꽃 정원이 있습니다."}        };

        var currentInfowindow = null; // 현재 열려 있는 인포윈도우

        function selectCourse(course) {
            var selectedCourse;
            switch(course) {
                case 'A코스':
                    selectedCourse = ["서울숲", "올림픽공원"];
                    break;
                case 'B코스':
                    selectedCourse = ["남산공원", "서울숲"];
                    break;
            }

            if (selectedCourse) {
                var start = places[selectedCourse[0]].latlng;
                var end = places[selectedCourse[1]].latlng;

                axios.get(`https://naveropenapi.apigw.ntruss.com/map-direction-15/v1/driving`, {
                    params: {
                        start: `${start.lng()},${start.lat()}`,
                        goal: `${end.lng()},${end.lat()}`,
                        option: "trafast"
                    },
                    headers: {
                        'X-NCP-APIGW-API-KEY-ID': 'YOUR_CLIENT_ID',
                        'X-NCP-APIGW-API-KEY': 'YOUR_CLIENT_SECRET'
                    }
                })
                .then(response => {
                    var route = response.data.route.trafast[0].path;
                    var path = route.map(coord => new naver.maps.LatLng(coord[1], coord[0]));

                    new naver.maps.Polyline({
                        map: map,
                        path: path,
                        strokeColor: course === "A코스" ? '#FF0000' : '#0000FF',
                        strokeWeight: 5
                    });

                    var infoContent = `
                        <div>
                            <h4>${course}</h4>
                            <p>예상 시간: ${Math.floor(response.data.route.trafast[0].summary.duration / 60)}분</p>
                        </div>
                    `;

                    if (currentInfowindow) {
                        currentInfowindow.close();
                    }

                    var infowindow = new naver.maps.InfoWindow({
                        content: infoContent,
                        maxWidth: 200,
                        borderColor: "#f1f1f1",
                        borderWidth: 2,
                        position: end
                    });

                    infowindow.open(map);
                    currentInfowindow = infowindow;
                })
                .catch(error=> {
                    console.error(error);
                });
            }
        }

        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("open");
            var mapDiv = document.getElementById("map");
            mapDiv.style.transition = "width 0.3s"; // 추가된 부분
            mapDiv.style.width = sidebar.classList.contains("open") ? "calc(100% - 250px)" : "100%";
        }
        
        Object.keys(places).forEach(placeName => {
            var place = places[placeName];
            var marker = new naver.maps.Marker({
                map: map,
                position: place.latlng,
                title: placeName // placeName으로 수정
            });

            var contentString = `
                <div style="width:200px;text-align:center;">
                    <h4>${placeName}</h4> <!-- placeName으로 수정 -->
                    <img src="${place.img}" alt="${placeName}" style="width:100%;height:auto;"> <!-- placeName으로 수정 -->
                    <p>${place.desc}</p>
                </div>
            `;

            var infowindow = new naver.maps.InfoWindow({
                content: contentString,
                maxWidth: 200,
                borderColor: "#f1f1f1",
                borderWidth: 2
            });

            naver.maps.Event.addListener(marker, "click", function() {
                if (currentInfowindow) {
                    currentInfowindow.close();
                }
                infowindow.open(map, marker);
                currentInfowindow = infowindow;
            });
        });
    </script>
</body>
</html>
