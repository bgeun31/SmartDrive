<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>서울 공원 드라이브 장소</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=3n3v7ntkle"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
        }
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        var mapOptions = {
            center: new naver.maps.LatLng(37.5665, 126.9780),
            zoom: 12
        };
        var map = new naver.maps.Map('map', mapOptions);

        var places = {
            "어린이대공원": {latlng: new naver.maps.LatLng(37.548014, 127.074576), img: "image/어린이대공원.jpeg", desc: "어린이대공원은 다양한 놀이 시설과 자연이 어우러진 공원입니다."},
            "양재시민의숲": {latlng: new naver.maps.LatLng(37.470314, 127.038366), img: "image/양재시민의숲.jpeg", desc: "양재시민의숲은 다양한 수목과 산책로가 있는 공원입니다."},
            "남산도시숲": {latlng: new naver.maps.LatLng(37.550759, 126.990902), img: "image/남산도시숲.jpeg", desc: "남산도시숲은 서울 도심 속 자연을 만끽할 수 있는 곳입니다."},
            "서울숲공원": {latlng: new naver.maps.LatLng(37.544552, 127.037665), img: "image/서울숲공원.jpeg", desc: "서울숲공원은 도심 속에서 자연을 즐길 수 있는 큰 공원입니다."}
        };

        var currentInfowindow = null; // 현재 열려 있는 인포윈도우
        var currentPolyline = null;   // 현재 표시된 폴리라인

        function showRouteToPlace(placeName) {
            var place = places[placeName];
            var currentLocation = map.getCenter();

            axios.get(`https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving`, {
                params: {
                    start: `${currentLocation.lng()},${currentLocation.lat()}`,
                    goal: `${place.latlng.lng()},${place.latlng.lat()}`,
                    option: "trafast"
                },
                headers: {
                    'X-NCP-APIGW-API-KEY-ID': '3n3v7ntkle',
                    'X-NCP-APIGW-API-KEY': 'c9xc0vQECxIbZS0s4Fh2DoYXfxHXV1dCPpKlsTig'
                }
            })
            .then(response => {
                if (response.data.route && response.data.route.trafast) {
                    var route = response.data.route.trafast[0].path;
                    var path = route.map(coord => new naver.maps.LatLng(coord[1], coord[0]));

                    if (currentPolyline) {
                        currentPolyline.setMap(null); // 이전 경로 제거
                    }

                    currentPolyline = new naver.maps.Polyline({
                        map: map,
                        path: path,
                        strokeColor: '#00FF00',
                        strokeWeight: 5
                    });

                    var infoContent = `
                        <div>
                            <h4>${placeName}</h4>
                            <p>예상 시간: ${Math.floor(response.data.route.trafast[0].summary.duration / 60)}분</p>
                        </div>
                    `;

                    if (currentInfowindow) {
                        currentInfowindow.close();
                    }

                    var infowindow = new naver.maps.InfoWindow({
                        content: infoContent,
                        maxWidth: 200,
                        borderColor: "#f1f1f1",
                        borderWidth: 2,
                        position: place.latlng
                    });

                    infowindow.open(map);
                    currentInfowindow = infowindow;
                } else {
                    console.error("경로 데이터를 찾을 수 없습니다.");
                }
            })
            .catch(error => {
                console.error("경로 요청 실패:", error);
            });
        }

        Object.keys(places).forEach(placeName => {
            var place = places[placeName];
            var marker = new naver.maps.Marker({
                map: map,
                position: place.latlng,
                title: placeName
            });

            var contentString = `
                <div style="width:200px;text-align:center;">
                    <h4>${placeName}</h4>
                    <img src="${place.img}" alt="${placeName}" style="width:100%;height:auto;">
                    <p>${place.desc}</p>
                    <button onclick="showRouteToPlace('${placeName}')">경로 보기</button>
                </div>
            `;

            var infowindow = new naver.maps.InfoWindow({
                content: contentString,
                maxWidth: 200,
                borderColor: "#f1f1f1",
                borderWidth: 2
            });

            naver.maps.Event.addListener(marker, "click", function() {
                if (currentInfowindow) {
                    currentInfowindow.close();
                }
                infowindow.open(map, marker);
                currentInfowindow = infowindow;
            });
        });

        // 페이지 로드 시 지도 초기화
        window.onload = function() {
            map.setCenter(new naver.maps.LatLng(37.5665, 126.9780));
        };
    </script>
</body>
</html>
